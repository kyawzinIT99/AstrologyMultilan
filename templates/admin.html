<!DOCTYPE html>
<html lang="my">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin | Dr.Tarot Tarot</title>
    <link href="https://fonts.googleapis.com/css2?family=Padauk:wght@400;700&display=swap" rel="stylesheet">
    <style>
        *,
        *::before,
        *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-deep: #0a0118;
            --bg-surface: #110827;
            --bg-card: rgba(26, 10, 58, 0.65);
            --border-subtle: rgba(139, 92, 246, 0.15);
            --accent-primary: #8b5cf6;
            --accent-secondary: #a78bfa;
            --accent-gold: #fbbf24;
            --accent-teal: #2dd4bf;
            --accent-red: #ef4444;
            --accent-green: #22c55e;
            --text-primary: #f1f0fb;
            --text-secondary: #a5a0c8;
            --text-muted: #6b639e;
            --radius: 16px;
        }

        html,
        body {
            min-height: 100vh;
            font-family: 'Padauk', system-ui, sans-serif;
            background: var(--bg-deep);
            color: var(--text-primary);
        }

        .stars-container {
            position: fixed;
            inset: 0;
            z-index: 0;
            overflow: hidden;
            pointer-events: none;
        }

        .star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            animation: twinkle var(--duration) ease-in-out infinite;
            opacity: 0;
        }

        @keyframes twinkle {

            0%,
            100% {
                opacity: 0;
            }

            50% {
                opacity: var(--max-opacity);
            }
        }

        .page {
            position: relative;
            z-index: 1;
            max-width: 800px;
            margin: 0 auto;
            padding: 24px 16px;
        }

        .header {
            text-align: center;
            padding: 24px 0;
        }

        .header h1 {
            font-size: 20px;
            background: linear-gradient(135deg, var(--accent-secondary), var(--accent-gold));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            color: var(--text-muted);
            font-size: 12px;
            margin-top: 4px;
        }

        .nav-links {
            display: flex;
            gap: 16px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .nav-links a {
            color: var(--text-secondary);
            font-size: 13px;
            text-decoration: none;
            transition: color 0.2s;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .nav-links a:hover {
            color: var(--accent-primary);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            backdrop-filter: blur(20px);
        }

        .stat-card .num {
            font-size: 28px;
            font-weight: 700;
        }

        .stat-card .label {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        .stat-pending .num {
            color: var(--accent-gold);
        }

        .stat-confirmed .num {
            color: var(--accent-teal);
        }

        .stat-total .num {
            color: var(--accent-secondary);
        }

        .card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 16px;
            backdrop-filter: blur(20px);
        }

        .card h2 {
            font-size: 15px;
            color: var(--accent-secondary);
            margin-bottom: 14px;
        }

        .booking-row {
            background: rgba(139, 92, 246, 0.06);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 14px 16px;
            margin-bottom: 10px;
        }

        .booking-row .top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .booking-row .name {
            font-size: 15px;
            font-weight: 700;
        }

        .booking-row .meta {
            font-size: 12px;
            color: var(--text-muted);
        }

        .booking-row .actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 7px 14px;
            border: none;
            border-radius: 8px;
            font-family: 'Padauk', sans-serif;
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            transition: all 0.2s;
        }

        .btn-confirm {
            background: rgba(34, 197, 94, 0.15);
            color: var(--accent-green);
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .btn-confirm:hover {
            background: rgba(34, 197, 94, 0.3);
        }

        .btn-reject {
            background: rgba(239, 68, 68, 0.15);
            color: var(--accent-red);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .btn-reject:hover {
            background: rgba(239, 68, 68, 0.3);
        }

        .btn-sms {
            background: rgba(139, 92, 246, 0.15);
            color: var(--accent-secondary);
            border: 1px solid rgba(139, 92, 246, 0.3);
        }

        .btn-sms:hover {
            background: rgba(139, 92, 246, 0.3);
        }

        .btn-sheets {
            background: rgba(251, 191, 36, 0.15);
            color: var(--accent-gold);
            border: 1px solid rgba(251, 191, 36, 0.3);
        }

        .btn-sheets:hover {
            background: rgba(251, 191, 36, 0.3);
        }

        .badge {
            font-size: 10px;
            padding: 3px 10px;
            border-radius: 20px;
            font-weight: 700;
        }

        .badge-pending {
            background: rgba(251, 191, 36, 0.15);
            color: var(--accent-gold);
        }

        .badge-confirmed {
            background: rgba(45, 212, 191, 0.15);
            color: var(--accent-teal);
        }

        .badge-rejected {
            background: rgba(239, 68, 68, 0.15);
            color: var(--accent-red);
        }

        .empty {
            text-align: center;
            padding: 30px;
            color: var(--text-muted);
            font-size: 13px;
        }

        .toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 16px;
        }

        .filter-btns {
            display: flex;
            gap: 6px;
        }

        .filter-btn {
            padding: 5px 12px;
            border: 1px solid var(--border-subtle);
            border-radius: 6px;
            background: transparent;
            color: var(--text-muted);
            font-family: 'Padauk', sans-serif;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .filter-btn.active {
            border-color: var(--accent-primary);
            color: var(--accent-primary);
            background: rgba(139, 92, 246, 0.1);
        }

        /* â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        @media (max-width: 600px) {
            .stats {
                grid-template-columns: 1fr;
            }

            .filter-btns {
                flex-wrap: wrap;
            }

            .booking-row .top {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .booking-row .actions {
                flex-direction: column;
                width: 100%;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>

<body>
    <div class="stars-container" id="starsContainer"></div>
    <div class="page">
        <div class="nav-links">
            <a href="/">â† Chat á€á€­á€¯á€· á€•á€¼á€”á€ºá€á€½á€¬á€¸á€›á€”á€º</a>
            <a href="/logout" style="color: var(--accent-pink);">ğŸšª á€¡á€€á€±á€¬á€„á€·á€ºá€‘á€½á€€á€ºá€™á€Šá€º</a>
            <a href="/booking">ğŸ“… Booking</a>
        </div>

        <div class="header">
            <h1>ğŸ”® Admin Dashboard</h1>
            <p>á€›á€€á€ºá€á€»á€­á€”á€ºá€¸ á€…á€®á€™á€¶á€á€”á€·á€ºá€á€½á€²á€›á€”á€º</p>
        </div>

        <div class="stats">
            <div class="stat-card stat-pending">
                <div class="num" id="pendingCount">0</div>
                <div class="label">á€…á€±á€¬á€„á€·á€ºá€†á€­á€¯á€„á€ºá€¸á€”á€±á€†á€²</div>
            </div>
            <div class="stat-card stat-confirmed">
                <div class="num" id="confirmedCount">0</div>
                <div class="label">á€¡á€á€Šá€ºá€•á€¼á€¯á€•á€¼á€®á€¸</div>
            </div>
            <div class="stat-card stat-total">
                <div class="num" id="totalCount">0</div>
                <div class="label">á€…á€¯á€…á€¯á€•á€±á€«á€„á€ºá€¸</div>
            </div>
        </div>

        <div class="toolbar">
            <div class="filter-btns">
                <button class="filter-btn active" onclick="filterBookings('all', this)">á€¡á€¬á€¸á€œá€¯á€¶á€¸</button>
                <button class="filter-btn" onclick="filterBookings('pending', this)">á€…á€±á€¬á€„á€·á€ºá€†á€­á€¯á€„á€ºá€¸á€”á€±á€†á€²</button>
                <button class="filter-btn" onclick="filterBookings('confirmed', this)">á€¡á€á€Šá€ºá€•á€¼á€¯á€•á€¼á€®á€¸</button>
                <button class="filter-btn" onclick="filterBookings('rejected', this)">á€•á€šá€ºá€á€»á€•á€¼á€®á€¸</button>
            </div>
            <div style="display:flex; gap: 8px;">
                <span style="color: var(--text-muted); font-size: 11px; padding: 5px 0;">n8n â†” Sheets + SMS</span>
            </div>
        </div>

        <div class="card">
            <h2>ğŸ“„ á€™á€Ÿá€¬á€˜á€¯á€á€º á† á€œ á€Ÿá€±á€¬á€…á€¬á€á€™á€ºá€¸ PDF á€‘á€¯á€á€ºá€›á€”á€º</h2>

            <!-- Year mode toggle -->
            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 4px;">
                <span style="font-size: 12px; color: var(--text-muted);">á€”á€¾á€…á€ºá€›á€­á€¯á€€á€ºá€‘á€Šá€·á€ºá€•á€¯á€¶á€…á€¶:</span>
                <button type="button" id="yearModeBtn" onclick="toggleYearMode()" style="padding: 4px 14px; border-radius: 20px; border: 1px solid var(--accent-primary);
                           background: rgba(139,92,246,0.15); color: var(--accent-secondary);
                           font-family: 'Padauk'; font-size: 12px; cursor: pointer;">
                    ğŸ“… CE (á€á€›á€…á€ºá€”á€¾á€…á€º)
                </button>
                <span id="yearModeHint" style="font-size: 11px; color: var(--text-muted);">
                    âœï¸ á€¥á€•á€™á€¬ - 1988
                </span>
            </div>

            <form id="pdfForm" onsubmit="generatePDF(event)" style="display: flex; flex-direction: column; gap: 12px;">
                <input type="text" id="pdfName" placeholder="á€¡á€™á€Šá€º" required
                    style="padding: 10px; border-radius: 8px; border: 1px solid var(--border-subtle); background: rgba(0,0,0,0.2); color: white; font-family: 'Padauk';">

                <!-- Custom date row: Day / Month / Year -->
                <div style="display: grid; grid-template-columns: 1fr 1fr 2fr; gap: 8px;">
                    <input type="number" id="pdfDay" placeholder="á€›á€€á€º (DD)" min="1" max="31" required
                        style="padding: 10px; border-radius: 8px; border: 1px solid var(--border-subtle); background: rgba(0,0,0,0.2); color: white; font-family: 'Padauk';">
                    <input type="number" id="pdfMonth" placeholder="á€œ (MM)" min="1" max="12" required
                        style="padding: 10px; border-radius: 8px; border: 1px solid var(--border-subtle); background: rgba(0,0,0,0.2); color: white; font-family: 'Padauk';">
                    <div style="position: relative;">
                        <input type="number" id="pdfYear" placeholder="á€”á€¾á€…á€º" min="1" required oninput="updateYearHint()"
                            style="padding: 10px; border-radius: 8px; border: 1px solid var(--border-subtle); background: rgba(0,0,0,0.2); color: white; font-family: 'Padauk'; width: 100%;">
                        <div id="cePreview"
                            style="font-size: 10px; color: var(--accent-teal); margin-top: 3px; min-height: 14px;">
                        </div>
                    </div>
                </div>

                <label
                    style="font-size: 13px; color: var(--text-secondary); display: flex; align-items: center; gap: 8px;">
                    <input type="checkbox" id="pdfIsWedPm"> á€—á€¯á€’á€¹á€“á€Ÿá€°á€¸ á€Šá€”á€± (á€›á€¬á€Ÿá€¯) á€–á€½á€¬á€¸á€–á€¼á€…á€ºá€•á€«á€á€œá€¬á€¸?
                </label>
                <button type="submit" id="pdfBtn" class="btn"
                    style="background: var(--accent-primary); color: white; border: none; font-size: 14px; padding: 10px; justify-content: center; margin-top: 5px;">
                    PDF á€‘á€¯á€á€ºá€™á€Šá€º
                </button>
            </form>
            <div id="pdfResult" style="margin-top: 15px; font-size: 13px; text-align: center; display: none;"></div>
        </div>

        <div class="card">
            <div id="bookingsList">
                <div class="empty">á€›á€€á€ºá€á€»á€­á€”á€ºá€¸ á€™á€›á€¾á€­á€á€±á€¸á€•á€«</div>
            </div>
        </div>
    </div>

    <script>
        let allBookings = [];
        let currentFilter = 'all';

        // Stars
        (function () {
            const c = document.getElementById('starsContainer');
            for (let i = 0; i < 40; i++) {
                const s = document.createElement('div'); s.className = 'star';
                s.style.left = Math.random() * 100 + '%'; s.style.top = Math.random() * 100 + '%';
                s.style.setProperty('--duration', (2 + Math.random() * 4) + 's');
                s.style.setProperty('--max-opacity', (0.3 + Math.random() * 0.7).toString());
                s.style.animationDelay = Math.random() * 4 + 's';
                c.appendChild(s);
            }
        })();

        async function loadBookings() {
            try {
                const res = await fetch('/api/bookings');
                const data = await res.json();
                allBookings = data.bookings || [];
                updateStats();
                renderBookings();
            } catch (e) { }
        }

        function updateStats() {
            const pending = allBookings.filter(b => b.status === 'pending').length;
            const confirmed = allBookings.filter(b => b.status === 'confirmed').length;
            document.getElementById('pendingCount').textContent = pending;
            document.getElementById('confirmedCount').textContent = confirmed;
            document.getElementById('totalCount').textContent = allBookings.length;
        }

        function filterBookings(status, btn) {
            currentFilter = status;
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            renderBookings();
        }

        function renderBookings() {
            const list = document.getElementById('bookingsList');
            const filtered = currentFilter === 'all' ? allBookings : allBookings.filter(b => b.status === currentFilter);

            if (filtered.length === 0) {
                list.innerHTML = '<div class="empty">á€›á€€á€ºá€á€»á€­á€”á€ºá€¸ á€™á€›á€¾á€­á€á€±á€¸á€•á€«</div>';
                return;
            }

            const topics = {
                general: 'á€¡á€‘á€½á€±á€‘á€½á€±', love: 'á€¡á€á€»á€…á€ºá€›á€±á€¸', career: 'á€¡á€œá€¯á€•á€ºá€¡á€€á€­á€¯á€„á€º',
                finance: 'á€„á€½á€±á€€á€¼á€±á€¸', health: 'á€€á€»á€”á€ºá€¸á€™á€¬á€›á€±á€¸', family: 'á€™á€­á€á€¬á€¸á€…á€¯', tarot: 'Tarot'
            };

            list.innerHTML = filtered.map(b => {
                const badgeClass = b.status === 'confirmed' ? 'badge-confirmed' :
                    b.status === 'rejected' ? 'badge-rejected' : 'badge-pending';
                const badgeText = b.status === 'confirmed' ? 'á€¡á€á€Šá€ºá€•á€¼á€¯á€•á€¼á€®á€¸' :
                    b.status === 'rejected' ? 'á€•á€šá€ºá€á€»á€•á€¼á€®á€¸' : 'á€…á€±á€¬á€„á€·á€ºá€†á€­á€¯á€„á€ºá€¸á€”á€±á€†á€²';
                const topic = topics[b.topic] || b.topic || 'á€¡á€‘á€½á€±á€‘á€½á€±';

                // SMS messages
                const confirmMsg = encodeURIComponent(
                    `á€™á€„á€ºá€¹á€‚á€œá€¬á€•á€« ${b.name}á‹ Dr.Tarot á€™á€Ÿá€¬á€˜á€¯á€á€º á€—á€±á€’á€„á€º & Tarot á€™á€¾ á€¡á€€á€¼á€±á€¬á€„á€ºá€¸á€€á€¼á€¬á€¸á€•á€«á€á€Šá€ºá‹ á€á€„á€·á€ºá€›á€€á€ºá€á€»á€­á€”á€ºá€¸ ${b.date} á€›á€€á€º ${b.time} á€¡á€á€»á€­á€”á€ºá€á€½á€„á€º á€¡á€á€Šá€ºá€•á€¼á€¯á€•á€¼á€®á€¸á€•á€«á€•á€¼á€®á‹ á€€á€»á€±á€¸á€‡á€°á€¸á€á€„á€ºá€•á€«á€á€Šá€ºá‹ ğŸ”®`
                );
                const rejectMsg = encodeURIComponent(
                    `á€™á€„á€ºá€¹á€‚á€œá€¬á€•á€« ${b.name}á‹ Dr.Tarot á€™á€Ÿá€¬á€˜á€¯á€á€º á€—á€±á€’á€„á€º & Tarot á€™á€¾ á€¡á€€á€¼á€±á€¬á€„á€ºá€¸á€€á€¼á€¬á€¸á€•á€«á€á€Šá€ºá‹ á€á€„á€·á€ºá€›á€€á€ºá€á€»á€­á€”á€ºá€¸ ${b.date} á€›á€€á€º ${b.time} á€¡á€á€»á€­á€”á€ºá€€á€­á€¯ á€•á€šá€ºá€–á€»á€€á€ºá€›á€•á€«á€á€Šá€ºá‹ á€¡á€á€¼á€¬á€¸á€›á€€á€º á€•á€¼á€”á€ºá€œá€Šá€ºá€šá€°á€•á€«á‹ ğŸ™`
                );

                const isPending = b.status === 'pending';

                return `
                    <div class="booking-row" id="row-${b.booking_id}">
                        <div class="top">
                            <div>
                                <span class="name">${b.name}</span>
                                <span style="color: var(--text-muted); font-size: 12px; margin-left: 8px;">${topic}</span>
                            </div>
                            <span class="badge ${badgeClass}">${badgeText}</span>
                        </div>
                        <div class="meta">
                            ğŸ“… ${b.date} &nbsp;|&nbsp; â° ${b.time} &nbsp;|&nbsp; ğŸ“ ${b.phone}
                            ${b.booking_id ? '&nbsp;|&nbsp; ğŸ”– ' + b.booking_id : ''}
                        </div>
                        <div class="actions">
                            ${isPending ? `
                                <a href="sms:${b.phone}?body=${confirmMsg}" class="btn btn-confirm" onclick="updateStatus('${b.booking_id}', 'confirmed')">âœ… á€¡á€á€Šá€ºá€•á€¼á€¯ SMS</a>
                                <a href="sms:${b.phone}?body=${rejectMsg}" class="btn btn-reject" onclick="updateStatus('${b.booking_id}', 'rejected')">âŒ á€•á€šá€ºá€á€» SMS</a>
                            ` : `
                                <a href="sms:${b.phone}" class="btn btn-sms">ğŸ’¬ SMS á€•á€­á€¯á€·á€›á€”á€º</a>
                            `}
                            <button class="btn btn-reject" style="margin-left:auto" onclick="deleteBooking('${b.booking_id}')">ğŸ—‘ï¸ á€–á€»á€€á€ºá€™á€Šá€º</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        async function updateStatus(bookingId, newStatus) {
            try {
                await fetch('/api/bookings/status', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ booking_id: bookingId, status: newStatus })
                });
                // Update local data
                const b = allBookings.find(x => x.booking_id === bookingId);
                if (b) b.status = newStatus;
                updateStats();
                renderBookings();
            } catch (e) { }
        }

        async function deleteBooking(bookingId) {
            if (!confirm("á€¤á€›á€€á€ºá€á€»á€­á€”á€ºá€¸á€€á€­á€¯ á€–á€»á€€á€ºá€›á€”á€º á€á€±á€á€»á€¬á€•á€«á€á€œá€¬á€¸?")) return;
            try {
                await fetch('/api/bookings/' + bookingId, {
                    method: 'DELETE'
                });
                allBookings = allBookings.filter(b => b.booking_id !== bookingId);
                updateStats();
                renderBookings();
            } catch (e) { }
        }

        // â”€â”€ BE / CE Year Toggle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        let yearMode = 'CE'; // 'CE' or 'BE'

        function toggleYearMode() {
            const btn = document.getElementById('yearModeBtn');
            const hint = document.getElementById('yearModeHint');
            if (yearMode === 'CE') {
                yearMode = 'BE';
                btn.innerHTML = 'ğŸŒ™ BE (á€—á€¯á€’á€¹á€“á€”á€¾á€…á€º)';
                btn.style.borderColor = 'var(--accent-gold)';
                btn.style.color = 'var(--accent-gold)';
                hint.textContent = 'âœï¸ á€¥á€•á€™á€¬ - 2531 (= 1988 CE)';
            } else {
                yearMode = 'CE';
                btn.innerHTML = 'ğŸ“… CE (á€á€›á€…á€ºá€”á€¾á€…á€º)';
                btn.style.borderColor = 'var(--accent-primary)';
                btn.style.color = 'var(--accent-secondary)';
                hint.textContent = 'âœï¸ á€¥á€•á€™á€¬ - 1988';
            }
            updateYearHint();
        }

        function updateYearHint() {
            const yearInput = document.getElementById('pdfYear');
            const preview = document.getElementById('cePreview');
            const val = parseInt(yearInput.value);
            if (!val || isNaN(val)) { preview.textContent = ''; return; }
            if (yearMode === 'BE') {
                const ce = val - 543;
                preview.textContent = `â†’ á€á€›á€…á€ºá€”á€¾á€…á€º: ${ce}`;
            } else {
                const be = val + 543;
                preview.textContent = `â†’ á€—á€¯á€’á€¹á€“á€”á€¾á€…á€º: ${be} BE`;
            }
        }

        // â”€â”€ PDF Generator â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        async function generatePDF(e) {
            e.preventDefault();
            const btn = document.getElementById('pdfBtn');
            const resultDiv = document.getElementById('pdfResult');
            const name = document.getElementById('pdfName').value.trim();
            const day = parseInt(document.getElementById('pdfDay').value);
            const month = parseInt(document.getElementById('pdfMonth').value);
            let year = parseInt(document.getElementById('pdfYear').value);
            const isWedPm = document.getElementById('pdfIsWedPm').checked;

            // Convert BE â†’ CE for the backend
            if (yearMode === 'BE') year = year - 543;

            if (!name || isNaN(day) || isNaN(month) || isNaN(year) || year < 1 || year > 9999) {
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = `<span style="color: var(--accent-red)">âŒ á€”á€¬á€™á€Šá€º / á€›á€€á€ºá€…á€½á€² á€•á€¼á€Šá€·á€ºá€…á€¯á€¶á€…á€½á€¬ á€–á€¼á€Šá€·á€ºá€•á€«</span>`;
                return;
            }

            // Format as YYYY-MM-DD
            const dob = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;

            btn.disabled = true;
            btn.textContent = 'Generating...';
            resultDiv.style.display = 'none';

            try {
                const res = await fetch('/api/admin/generate_pdf', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, dob, is_wednesday_pm: isWedPm })
                });
                const data = await res.json();

                resultDiv.style.display = 'block';
                if (res.ok) {
                    resultDiv.innerHTML = `<a href="${data.url}" target="_blank" style="color: var(--accent-teal); text-decoration: underline;">âœ… ${name} á€¡á€á€½á€€á€º PDF á€’á€±á€«á€„á€ºá€¸á€œá€¯á€’á€ºá€›á€šá€°á€›á€”á€º á€”á€¾á€­á€•á€ºá€•á€«</a>`;
                } else {
                    resultDiv.innerHTML = `<span style="color: var(--accent-red)">âŒ Error: ${data.error}</span>`;
                }
            } catch (err) {
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = `<span style="color: var(--accent-red)">âŒ Failed to generate PDF</span>`;
            } finally {
                btn.disabled = false;
                btn.textContent = 'PDF á€‘á€¯á€á€ºá€™á€Šá€º';
            }
        }

        loadBookings();
    </script>
</body>

</html>